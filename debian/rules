#!/usr/bin/make -f

%:
	dh $@ --with python3 --with systemd

# Needed to suppress:
# Can't exec "arm-linux-gnueabihf-strip": No such file or directory at /usr/share/perl5/Debian/Debhelper/Dh_Lib.pm line 225.
# dh_strip: arm-linux-gnueabihf-strip --remove-section=.comment --remove-section=.note debian/pt-device-manager/usr/lib/pt-device-manager/poweroff-legacy failed to to execute: No such file or directory
override_dh_strip:
	dh_strip -Xpoweroff-legacy

# Needed to suppress:
# dpkg-shlibdeps: warning: couldn't find library libwiringPi.so needed by debian/pt-device-manager/usr/lib/pt-device-manager/poweroff-legacy (ELF format: 'elf32-little'; RPATH: '')
# dpkg-shlibdeps: error: couldn't find library libc.so.6 needed by debian/pt-device-manager/usr/lib/pt-device-manager/poweroff-legacy (ELF format: 'elf32-little'; RPATH: '')
# dpkg-shlibdeps: error: cannot continue due to the error above
override_dh_shlibdeps:
	dh_shlibdeps -Xpoweroff-legacy

override_dh_installinit:
	dh_installinit --noscripts

override_dh_systemd_enable:
	dh_systemd_enable --name=pt-device-manager
	dh_systemd_enable --name=pt-oled-startup-anim
	dh_systemd_enable --name=pt-poweroff

override_dh_systemd_start:
	dh_systemd_start pt-device-manager
	dh_systemd_start --no-start --no-restart-on-upgrade pt-oled-startup-anim
	dh_systemd_start --no-start --no-restart-on-upgrade pt-poweroff

# Needed to suppress Lintian error:
# missing-dependency-on-libc needed by usr/lib/pt-device-manager/poweroff-legacy

override_dh_gencontrol:
	dh_gencontrol -- -Vshlibs:Depends="libc6 (>= 2.24-11)"
